<!-- 设置页（TDesign Weixin） -->
<view class="page">
  <view class="header">
    <view class="title">设置</view>
  </view>
  
  <view class="section">
    <t-cell-group>
      <t-cell title="相册自动滚动速度" description="数值越小越慢(1-999)" note="{{albumScrollSpeed}}" bindtap="onEditScrollSpeed" arrow />
<!--
      <t-cell title="纯黑画笔" description="开启后画笔颜色固定为黑色">
        <t-switch slot="note" value="{{pureBlackBrush}}" bind:change="onPureBlackBrushChange" />
      </t-cell>

      <t-cell title="清理缓存" description="删除本地临时文件与缩略图">
        <view slot="note">
          <t-button variant="outline" size="small" theme="default" bindtap="onClearCache">清理</t-button>
        </view>
      </t-cell>

      <t-cell title="撤回步数上限" description="点击修改" note="{{maxUndoSteps}}" bindtap="onEditUndoLimit" arrow />
      <t-cell title="退出时提示保存" description="若有未保存更改，退出编辑页时进行提示">
        <t-switch slot="note" value="{{exitConfirm}}" bind:change="onExitConfirmChange" />
      </t-cell>
-->
    </t-cell-group>
  </view>

  <!-- 蓝牙打印机设置 -->
  <view class="section">
    <view class="card">
      <view class="card-title">蓝牙打印机</view>
      <view class="card-desc">设置蓝牙打印机连接，用于作品打印。</view>
      <view class="card-actions">
        <t-button theme="primary" size="small" bindtap="clickStartScanBleDevice" disabled="{{isScanning}}">
          {{isScanning ? '搜索中...' : '搜索设备'}}
        </t-button>
        <t-button variant="outline" theme="default" size="small" bindtap="clickDisconnectBleDevice" disabled="{{!connectedDevice}}">
          断开连接
        </t-button>
        <t-button variant="outline" theme="primary" size="small" bindtap="clickConsumableInformation" disabled="{{!connectedDevice}}">
          获取耗材信息
        </t-button>
      </view>
      <view class="connection-status" wx:if="{{connectedDevice}}">
        <text class="status-label">已连接设备:</text>
        <text class="status-value">{{connectedDevice.name || connectedDevice.deviceId}}</text>
      </view>
      <!-- 设备列表 -->
      <view class="device-list" wx:if="{{blueList.length > 0 || isScanning}}">
        <view wx:if="{{isScanning && blueList.length === 0}}" class="no-devices">
          正在搜索蓝牙设备...
        </view>
        <view wx:for="{{blueList}}" wx:key="deviceId" class="device-item" bindtap="clickConnectBleDevice" data-device="{{item}}">
          <view class="device-info">
            <view class="device-name">{{item.name || '未知设备'}}</view>
            <view class="device-id">ID: {{item.deviceId}}</view>
          </view>
          <view class="device-status">
            <t-icon name="check-circle" wx:if="{{connectedDevice && connectedDevice.deviceId === item.deviceId}}" size="24" color="#07c160" />
            <t-icon name="chevron-right" wx:else size="20" color="#86909c" />
          </view>
        </view>
      </view>
    </view>
  </view>

  <view class="section">
    <view class="card">
      <view class="card-title">相册导出</view>
      <view class="card-desc">导出作品到系统相册需要 <text class="em">scope.writePhotosAlbum</text> 授权。</view>
      <view class="card-actions">
        <t-button theme="primary" size="small" bindtap="onRequestAlbumAuth">申请授权</t-button>
        <t-button variant="outline" theme="default" size="small" bindtap="onOpenSetting">去设置</t-button>
      </view>
    </view>
  </view>

  <view class="bottom">
    <t-button variant="outline" theme="default" block bindtap="onBackHome">返回</t-button>
  </view>

  <t-dialog
    visible="{{limitDialogVisible}}"
    title="设置撤回步数上限"
    confirm-btn="确定"
    cancel-btn="取消"
    bind:confirm="onLimitConfirm"
    bind:cancel="onLimitCancel"
  >
    <t-input
      slot="content"
      borderless
      class="dialog-input"
      clearable
      placeholder="请输入数字(5-20)"
      value="{{tempLimitValue}}"
      type="number"
      bind:change="onLimitInputChange"
    />
  </t-dialog>

  <t-dialog
    visible="{{speedDialogVisible}}"
    title="设置自动滚动速度"
    confirm-btn="确定"
    cancel-btn="取消"
    bind:confirm="onSpeedConfirm"
    bind:cancel="onSpeedCancel"
  >
    <t-input
      slot="content"
      borderless
      class="dialog-input"
      clearable
      placeholder="请输入数字(1-999)"
      value="{{tempSpeedValue}}"
      type="number"
      bind:change="onSpeedInputChange"
    />
  </t-dialog>

  <!-- 耗材信息对话框 -->
  <t-dialog
    visible="{{consumableInfoVisible}}"
    title="耗材信息"
    confirm-btn="确定"
    show-cancel="{{false}}"
    bind:confirm="onCloseConsumableInfo"
  >
    <view slot="content" class="consumable-info-content" wx:if="{{consumableInfo}}">
      <view class="info-item">
        <text class="info-label">耗材间隙：</text>
        <text class="info-value">{{consumableInfo.gap}}mm</text>
      </view>
      <view class="info-item">
        <text class="info-label">出纸方向尺寸：</text>
        <text class="info-value">{{consumableInfo.paperDirectionSize}}mm</text>
      </view>
      <view class="info-item">
        <text class="info-label">打印头方向尺寸：</text>
        <text class="info-value">{{consumableInfo.printHeadDirectionSize}}mm</text>
      </view>
    </view>
  </t-dialog>
</view>

